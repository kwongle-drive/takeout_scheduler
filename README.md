# takeout_server
[구글의 테이크 아웃](https://takeout.google.com/u/2/)기능을 구현한다.  
사용자의 드라이브를 사용자가 요청된 용량만큼 나눠서 zip파일 생성후 다운로드 링크 제공  

**참고이미지 - 구글 드라이브 테이크 아웃 결과**  
![image](https://user-images.githubusercontent.com/22045187/155680408-7c8341ce-4c02-4000-8036-952ac7515143.png)

## 작동 방식

### 메인 프로세스 
1. 메인 프로세스에서 DB에서 요청된 테이크아웃 요청을 최대 100건을 가져온 후 워커 프로세스에 전송힌디.
2. 워커 프로세스에서 전달 받은 테이크 아웃 요청을 처리완료하는 이벤트를 받으면 DATABASE업데이트를 한다.
3. 워커 프로세스에 전송한 모든 테이크 아웃요청들이 완료되면 다시 DB에서 대기중인 테이크아웃 요청 확인힌다.

### 워커 프로세스
1. 메인 프로세스에서 전송받은 테이크아웃 요청들을 1건씩 처리한다.
2. 워커프로세스의 메인 쓰레드에서 수행할 테이크 아웃요쳥 유저의 드라이브를 탐색하여 처리할 파일들과 드라이브 폴더 구조를 가져온다.
3. 메인 쓰레드에서 처리할 파일들을 설정한 용량만큼 작업을 나누어 워커 쓰레드에게 제공한다.
4. 워커 쓰레드에서 기본 드라이브 폴더 구조를 ZIP파일에 생성한 후 처리할 파일들을 ZIP파일에 스트림 방식으로 전송한다.
5. 모든 워커쓰레드가 작업이 완료되면 메인 쓰레드에서 메인 프로세스로 전달되는 처리완료 이벤트 EMIT.
6. 모든 테이크 아웃 요청들이 완료되면 메인 프로세스에 ALL 처리 완료 이벤트 EMIT.

### 참고 이미지
![Untitled Diagram drawio (1)](https://user-images.githubusercontent.com/22045187/155679262-7dad12aa-037e-4781-8d91-7a7f1ce1c15e.png)
